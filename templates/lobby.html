{% load static%}

<!DOCTYPE html>
<html>
  <head>
    <meta charset ="UTF-8">
    <title>Lobby</title>
    <link rel="stylesheet" href="{% static 'styleLobby.css' %}">
    <link rel="shortcut icon" type="image/png" href="{% static 'images/std-icon.png' %}">
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
  </head>
  <body>

    <div class="lobbyTop">
      <h1>Lobby</h1>

      <select name="modes" id="modeSelect">
        <option value="werWolf">Werwolf</option>
        <option value="secretHitler">Secret Hitler</option>        
      </select> 
    </div>

    <div id="currentPlayerName" class="playerNames">
      Dein Name: 
    </div>

    <div class="figures">              
          
      <img src="{% static 'images/play.webp' %}" id="figureStart" title="start" alt="start" onclick="init()">        
      
      <a href="/removePlayer">
        <img src="{% static 'images/back.webp' %}" id="figureBack" title="back" alt="back">
      </a>           

    </div>

    <script> 
      document.getElementById('currentPlayerName').innerHTML = 'Dein Name: ' + JSON.parse(getCookie('userData')).playerName;

      $(document).ready(function(){
      setInterval(function(){
            $("#lobbyPlayerList").load(window.location.href + " #lobbyPlayerList" );
            //$("#manageButton").load(window.location.href + " #manageButton" );
            
            updateView();
            
      }, 1000);
      });  
      
      function init() {
        
        var selectSection = document.getElementById('modeSelect');
        var currentMode = selectSection.options[selectSection.selectedIndex].text;
        
        if (currentMode == 'Secret Hitler') {
          if (confirm('Start Game?')){
            location.replace('/game');
          }          
        } else {
          location.replace('/werwolfList');
        }
      }

      function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
      }
      console.log(getCookie('userData'))
    </script>     

    <div id="lobbyPlayerList">                  
      {% for id, name in lobbyList.items %}

        <div id="Player {{ forloop.counter }}" class="playerNames">
          Player {{ forloop.counter }}: {{name}}
        </div>                          
      
      {% endfor %}
    </div>

    <div id="manageButton">            
      <script>
        function updateView(){

          var playerOne = document.getElementById('Player 1').innerHTML.split(':')[1].trim();          
          var playerNameCookie = JSON.parse(getCookie('userData')).playerName;                    
          
          if (playerNameCookie.localeCompare(playerOne) == 0){
            document.getElementById('figureStart').style.visibility = 'visible';
            document.getElementById('modeSelect').style.visibility = 'visible';            
        
          } else {
            document.getElementById('figureStart').style.visibility = 'hidden';
            document.getElementById('modeSelect').style.visibility = 'hidden';            
          }
        } 

        updateView();
                
      </script>
    <div>

  </body>
</html>
